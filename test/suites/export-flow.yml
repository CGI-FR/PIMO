name: flow chart feature
testcases:
  - name: export mermaid
    steps:
      - script: rm -f masking.yml
      - script: |-
          cat > masking.yml <<EOF
          version: "1"
          masking:
            - selector:
                jsonpath: "name"
              mask:
                add: "toto"
          EOF
      - script: pimo flow > masking.mmd
        assertions:
          - result.code ShouldEqual 0
      - script: |-
          cat > expected.mmd <<EOF
          flowchart LR
              toto -->|Add| name
              
          EOF
      - script: diff masking.mmd expected.mmd
        assertions:
          - result.code ShouldEqual 0
          - result.systemout ShouldBeEmpty

  - name: export mermaid multiple masks
    steps:
      - script: rm -f masking.yml
      - script: |-
          cat > masking.yml <<EOF
          version: "1"
          masking:
            - selector:
                jsonpath: "name"
              masks:
                - add: ""
                - template: "hello {{.input}}"
          EOF
      - script: pimo flow >  masking.mmd
        assertions:
          - result.code ShouldEqual 0
      - script: |-
          cat > expected.mmd <<EOF
          flowchart LR
               -->|Add| name
              hello {{.input}} -->|Template| name
              
          EOF
      - script: diff masking.mmd expected.mmd
        assertions:
          - result.code ShouldEqual 0
          - result.systemout ShouldBeEmpty
